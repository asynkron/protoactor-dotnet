@page "/ClusterDiagnostics"
@using Proto.Diagnostics
@using System.Text.Json
@inject ActorSystem System

<PageTitle>Cluster Diagnostics</PageTitle>
@if (_diagnostics is not null)
{
    <MudTable T="DiagnosticsEntry" Items="_diagnostics.OrderBy(e => e.Module).ThenBy(e => e.Message)">
        <HeaderContent>
            <MudTh>Module</MudTh>
            <MudTh>Message</MudTh>
            <MudTh>Data</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Nr">@context.Module</MudTd>
            <MudTd DataLabel="Sign">@context.Message</MudTd>
            <MudTd DataLabel="Name">
                <pre>
                @AsJson(context.Data)
                </pre>
            </MudTd>
        </RowTemplate>
    </MudTable>
}

@code {
    private DiagnosticsEntry[]? _diagnostics;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        _diagnostics = await System.Diagnostics.GetDiagnostics();
    }

    private string AsJson(object? data)
    {
        if (data is null)
        {
            return "";
        }
        var res = JsonSerializer.Serialize(data, new JsonSerializerOptions()
        {
            WriteIndented = true 
        });
        return res;
    }

}